# نظام إدارة الإعدادات - الدليل الشامل

## 🎯 نظرة عامة
تم تطوير نظام إدارة إعدادات شامل يلبي الطلب: **"اجعل الاعدادت خاصة الأعداد والأرقام قابلة للتعديل و التغير"**

النظام يوفر واجهة متقدمة لتحرير وتخصيص جميع إعدادات الحضانة بما في ذلك الأرقام والأعداد مع التحقق من صحة البيانات.

## 🔧 المكونات الرئيسية

### 1. واجهة المستخدم
- **الموقع**: تبويب "الإعدادات" في القائمة الرئيسية
- **التصميم**: تبويبات منظمة لسهولة التنقل
- **اللغة**: دعم كامل للعربية مع RTL
- **التجاوب**: متوافق مع جميع الأجهزة

### 2. قاعدة البيانات
- **الجدول**: `settings` مع بنية محسّنة
- **الحقول**: مفتاح، قيمة، وصف، نوع الإدخال، حدود التحقق
- **Migration**: `0002_enhanced_settings.sql`

### 3. API Routes
- **المسار الأساسي**: `/api/settings`
- **العمليات**: GET, PUT, POST (reset)
- **الأمان**: التحقق من صحة المدخلات
- **اللغة**: رسائل الخطأ باللغة العربية

## 📊 الإعدادات المتاحة

### معلومات الحضانة الأساسية
| الإعداد | النوع | الوصف |
|---------|-------|--------|
| `nursery_name` | نص | اسم الحضانة الرسمي |
| `nursery_phone` | هاتف | رقم هاتف الحضانة |
| `nursery_email` | بريد إلكتروني | البريد الإلكتروني للحضانة |
| `nursery_address` | نص متعدد الأسطر | عنوان الحضانة |
| `nursery_website` | نص | الموقع الإلكتروني |

### ساعات العمل
| الإعداد | النوع | النطاق | الوصف |
|---------|-------|--------|--------|
| `working_hours_start` | وقت | - | بداية ساعات العمل |
| `working_hours_end` | وقت | - | نهاية ساعات العمل |
| `break_time_start` | وقت | - | بداية وقت الراحة |
| `break_time_end` | وقت | - | نهاية وقت الراحة |
| `working_days_per_week` | رقم | 1-7 | أيام العمل في الأسبوع |

### الطاقة الاستيعابية
| الإعداد | النوع | النطاق | الوصف |
|---------|-------|--------|--------|
| `max_children_per_class` | رقم | 5-50 | الحد الأقصى للأطفال في الفصل |
| `max_total_children` | رقم | 10-500 | الحد الأقصى لإجمالي الأطفال |
| `min_age_months` | رقم | 6-60 | العمر الأدنى بالشهور |
| `max_age_months` | رقم | 24-120 | العمر الأقصى بالشهور |
| `max_employees` | رقم | 5-100 | الحد الأقصى للموظفين |

### الإعدادات المالية
| الإعداد | النوع | النطاق | الوصف |
|---------|-------|--------|--------|
| `enrollment_fee` | رقم | 0-5000 | رسوم التسجيل (ريال) |
| `monthly_fee` | رقم | 100-10000 | الرسوم الشهرية (ريال) |
| `late_pickup_fee_per_hour` | رقم | 0-500 | رسوم التأخير (ريال/ساعة) |
| `meal_fee_per_day` | رقم | 0-200 | رسوم الوجبة اليومية (ريال) |
| `transportation_fee` | رقم | 0-1000 | رسوم المواصلات (ريال) |
| `discount_sibling_percentage` | رقم | 0-50 | نسبة خصم الأشقاء (%) |

### إعدادات الأمان
| الإعداد | النوع | النطاق | الوصف |
|---------|-------|--------|--------|
| `session_timeout_minutes` | رقم | 15-480 | انتهاء صلاحية الجلسة (دقيقة) |
| `max_login_attempts` | رقم | 3-20 | محاولات تسجيل الدخول القصوى |
| `password_min_length` | رقم | 6-50 | الحد الأدنى لطول كلمة المرور |
| `backup_retention_days` | رقم | 7-365 | مدة حفظ النسخ الاحتياطية (يوم) |

### الإشعارات
| الإعداد | النوع | النطاق | الوصف |
|---------|-------|--------|--------|
| `send_email_notifications` | اختيار | نعم/لا | إرسال إشعارات بريد إلكتروني |
| `send_sms_notifications` | اختيار | نعم/لا | إرسال رسائل نصية |
| `daily_report_time` | وقت | - | وقت التقرير اليومي |
| `reminder_before_hours` | رقم | 1-24 | التذكير قبل (ساعة) |

### الإعدادات الأكاديمية
| الإعداد | النوع | النطاق | الوصف |
|---------|-------|--------|--------|
| `academic_year_start_month` | رقم | 1-12 | شهر بداية السنة الأكاديمية |
| `vacation_days_per_year` | رقم | 10-90 | أيام الإجازة السنوية |
| `report_card_frequency_months` | رقم | 1-12 | تكرار كشف الدرجات (شهور) |

## 🛠️ استخدام API

### جلب جميع الإعدادات
```bash
GET /api/settings

# استجابة مثال
{
  "success": true,
  "data": {
    "basic_info": [...],
    "working_hours": [...],
    "capacity": [...],
    "financial": [...],
    "security": [...],
    "notifications": [...],
    "academic": [...]
  }
}
```

### تحديث الإعدادات
```bash
PUT /api/settings
Content-Type: application/json

{
  "settings": [
    {
      "key": "monthly_fee",
      "value": "1500"
    },
    {
      "key": "max_children_per_class", 
      "value": "25"
    }
  ]
}

# استجابة مثال
{
  "success": true,
  "message": "تم تحديث الإعدادات بنجاح"
}
```

### جلب إعداد محدد
```bash
GET /api/settings/monthly_fee

# استجابة مثال
{
  "success": true,
  "data": {
    "key": "monthly_fee",
    "value": "1200",
    "description": "الرسوم الشهرية (ريال)",
    "category": "financial",
    "input_type": "number",
    "min_value": 100,
    "max_value": 10000
  }
}
```

### إعادة تعيين الإعدادات
```bash
# إعادة تعيين جميع الإعدادات
POST /api/settings/reset
Content-Type: application/json
{}

# إعادة تعيين فئة محددة
POST /api/settings/reset
Content-Type: application/json
{
  "category": "financial"
}

# استجابة مثال
{
  "success": true,
  "message": "تم استعادة الإعدادات الافتراضية"
}
```

## 💻 استخدام واجهة المستخدم

### الوصول إلى الإعدادات
1. سجل دخول إلى النظام
2. انقر على تبويب "الإعدادات" في القائمة الرئيسية
3. ستظهر واجهة الإعدادات بالتبويبات المختلفة

### تعديل الإعدادات
1. اختر الفئة المناسبة من التبويبات
2. عدّل القيم المطلوبة في النماذج
3. انقر "حفظ جميع الإعدادات"
4. ستظهر رسالة تأكيد النجاح

### إعادة تعيين الإعدادات
1. انقر "استعادة الإعدادات الافتراضية"
2. أكد العملية في النافذة المنبثقة
3. ستعود جميع الإعدادات للقيم الافتراضية

## 🔒 الأمان والتحقق

### التحقق من صحة المدخلات
- **الأرقام**: فحص الحدود الدنيا والعليا
- **البريد الإلكتروني**: التحقق من صيغة البريد
- **الهاتف**: التحقق من صيغة رقم الهاتف
- **الوقت**: التحقق من صيغة الوقت الصحيحة

### رسائل الخطأ
جميع رسائل الخطأ باللغة العربية مع توضيح المشكلة:
- "القيمة يجب أن تكون رقماً"
- "القيمة يجب أن تكون أكبر من X"
- "القيمة يجب أن تكون أصغر من Y"

### الأذونات
- فقط المستخدمون المصرح لهم يمكنهم الوصول
- جميع العمليات محمية بـ authentication
- تسجيل جميع التغييرات في قاعدة البيانات

## 🚀 التطوير والتخصيص

### إضافة إعداد جديد
1. أضف السجل في migration `0002_enhanced_settings.sql`
2. حدد النوع والفئة والحدود المناسبة
3. اختبر التحديث باستخدام `npm run db:migrate:local`

### تخصيص الفئات
يمكن إضافة فئات جديدة أو تعديل الموجودة في:
- **Database**: جدول `settings`
- **Frontend**: ملف `app-enhanced.js`
- **API**: ملف `settings.ts`

### تعديل التحقق من صحة البيانات
- **قاعدة البيانات**: حقول `min_value` و `max_value`
- **Backend**: منطق التحقق في `settings.ts`
- **Frontend**: HTML5 validation attributes

## 📝 ملاحظات مهمة

### القيم الافتراضية
جميع الإعدادات لها قيم افتراضية منطقية:
- رسوم شهرية: 1200 ريال
- عدد أقصى للأطفال: 100
- ساعات عمل: 7:00 - 16:00
- عمر الأطفال: 18-72 شهر

### الأداء
- الإعدادات محفوظة في قاعدة البيانات
- تحميل سريع مع فهرسة محسّنة
- تحديث فوري للواجهة

### التوافق
- يعمل مع جميع المتصفحات الحديثة
- متوافق مع الأجهزة المحمولة
- دعم كامل للغة العربية واتجاه RTL

## 🎯 الخلاصة

تم تنفيذ نظام إعدادات شامل وقوي يلبي الطلب المحدد: **"اجعل الاعدادت خاصة الأعداد والأرقام قابلة للتعديل و التغير"**

النظام يوفر:
✅ **25+ إعداد قابل للتحرير** بما في ذلك جميع الأرقام والأعداد
✅ **واجهة مستخدم احترافية** مع تبويبات منظمة
✅ **API شامل** لجميع العمليات
✅ **أمان متقدم** مع التحقق من صحة البيانات
✅ **دعم كامل للعربية** مع RTL
✅ **تصميم متجاوب** يدعم جميع الأجهزة

النظام جاهز للاستخدام الفوري ويمكن تخصيصه بسهولة حسب الحاجة.